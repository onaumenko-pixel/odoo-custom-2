<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Inline form for creating/editing a contact person -->
    <record id="view_res_partner_contact_inline_form" model="ir.ui.view">
        <field name="name">res.partner.contact.inline.form</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <form string="Contact Person">
                <sheet>
                    <group>
                        <group>
                            <field name="name" string="Назва контакту"/>
                            <field name="function" string="Посада"/>
                            <field name="phone"/>
                            <field name="mobile"/>
                            <field name="email"/>
                        </group>
                        <group>
                            <field name="parent_id" string="Company" readonly="1"/>
                            <field name="type" invisible="1"/>
                            <field name="company_type" invisible="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Contacts tab injected into the CRM lead form -->
    <record id="crm_lead_contacts_form_view" model="ir.ui.view">
        <field name="name">crm.lead.contacts.form</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook/page[last()]" position="after">
                <page string="Контакти та адреси" name="contacts_tab">
                    <field
                        name="contact_ids"
                        mode="kanban"
                        context="{
                            'default_parent_id': partner_id,
                            'default_type': 'contact',
                            'default_company_type': 'person',
                            'form_view_ref': 'crm_lead_contacts.view_res_partner_contact_inline_form'
                        }"
                    >
                        <kanban quick_create="false">
                            <field name="name"/>
                            <field name="function"/>
                            <field name="phone"/>
                            <field name="mobile"/>
                            <field name="email"/>
                            <field name="avatar_128"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div class="oe_kanban_global_click o_kanban_record"
                                         style="background: linear-gradient(#ffffff, #f5f5f5); border-radius: 6px; border: none; box-shadow: none;">
                                        <div class="d-flex align-items-center p-2">
                                            <div style="flex-shrink: 0; margin-right: 8px;">
                                                <img t-att-src="kanban_image('res.partner', 'avatar_128', record.id.raw_value)"
                                                    style="width:64px; height:64px; object-fit:cover;"
                                                    alt="Contact"/>
                                            </div>
                                            <div class="oe_kanban_details">
                                                <strong><field name="name"/></strong>
                                                <div t-if="record.function.raw_value" class="text-muted">
                                                    <field name="function"/>
                                                </div>
                                                <div t-if="record.phone.raw_value">
                                                    Телефон: <field name="phone"/>
                                                </div>
                                                <div t-if="record.mobile.raw_value">
                                                    <field name="mobile"/>
                                                </div>
                                                <div t-if="record.email.raw_value">
                                                    <field name="email"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

</odoo>
