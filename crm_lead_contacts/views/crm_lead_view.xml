<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Inline form for creating/editing a contact person -->
    <record id="view_res_partner_contact_inline_form" model="ir.ui.view">
        <field name="name">res.partner.contact.inline.form</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <form string="Contact Person">
                <sheet>
                    <group>
                        <group>
                            <field name="name" string="Full Name"/>
                            <field name="function" string="Job Position"/>
                            <field name="phone"/>
                            <field name="mobile"/>
                            <field name="email"/>
                        </group>
                        <group>
                            <field name="parent_id" string="Company" readonly="1"/>
                            <field name="type" invisible="1"/>
                            <field name="company_type" invisible="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Contacts tab injected into the CRM lead form -->
    <record id="crm_lead_contacts_form_view" model="ir.ui.view">
        <field name="name">crm.lead.contacts.form</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook/page[last()]" position="after">
                <page string="Contacts" name="contacts_tab">
                    <field
                        name="contact_ids"
                        mode="kanban"
                        context="{
                            'default_parent_id': partner_id,
                            'default_type': 'contact',
                            'default_company_type': 'person',
                            'form_view_ref': 'crm_lead_contacts.view_res_partner_contact_inline_form'
                        }"
                    >
                        <kanban quick_create="false">
                            <field name="name"/>
                            <field name="function"/>
                            <field name="phone"/>
                            <field name="mobile"/>
                            <field name="email"/>
                            <field name="image_128"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div class="oe_kanban_global_click o_kanban_record"
                                         style="min-width: 300px; padding: 8px 12px;">
                                        <div class="d-flex align-items-center">
                                            <!-- Аватар слева -->
                                            <div style="flex-shrink: 0; margin-right: 12px;">
                                                <img
                                                    t-att-src="kanban_image('res.partner', 'image_128', record.id.raw_value)"
                                                    style="width:48px; height:48px; border-radius:50%; object-fit:cover; background:#e0e0e0;"
                                                    alt="Contact"
                                                />
                                            </div>
                                            <!-- Данные справа -->
                                            <div style="flex: 1; min-width: 0;">
                                                <div style="font-weight: 600; font-size: 13px;">
                                                    <field name="name"/>
                                                </div>
                                                <t t-if="record.function.value">
                                                    <div style="color: #666; font-size: 12px;">
                                                        <field name="function"/>
                                                    </div>
                                                </t>
                                                <t t-if="record.phone.value">
                                                    <div style="font-size: 12px; margin-top: 2px;">
                                                        Телефон: <field name="phone"/>
                                                    </div>
                                                </t>
                                                <t t-if="record.mobile.value">
                                                    <div style="font-size: 12px;">
                                                        <field name="mobile"/>
                                                    </div>
                                                </t>
                                                <t t-if="record.email.value">
                                                    <div style="font-size: 12px;">
                                                        <field name="email"/>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

</odoo>
